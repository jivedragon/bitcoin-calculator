<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bitcoin Goal Calculator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),
          url("https://images.unsplash.com/photo-1544635576-5f58e89be4f6?q=80&w=1000");
        background-size: cover;
        background-attachment: fixed;
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .calculator {
        background-color: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
        border: 2px solid #c41e3a;
      }
      .input-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #c41e3a;
      }
      input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      input:focus {
        outline: none;
        border-color: #f7931a;
      }
      button {
        background-color: #c41e3a;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        font-size: 16px;
      }
      button:hover {
        background-color: #a01830;
      }
      #result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 4px;
        background-color: rgba(240, 240, 240, 0.9);
        display: none;
      }
      .current-price {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.2em;
        color: #c41e3a;
      }
      .error {
        background-color: #ffe6e6;
        color: #d63939;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
      }
      .success {
        background-color: rgba(230, 255, 230, 0.9);
        color: #2d862d;
      }
      .info-box {
        background-color: rgba(230, 243, 255, 0.9);
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        font-size: 0.9em;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: right;
      }
      th {
        background-color: #c41e3a;
        color: white;
        text-align: center;
      }
      tr:nth-child(even) {
        background-color: rgba(249, 249, 249, 0.9);
      }
      .halving-row {
        background-color: rgba(255, 243, 230, 0.9) !important;
        font-weight: bold;
      }
      h1 {
        color: #c41e3a;
        text-align: center;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* Snow Animation */
      .snowflake {
        position: fixed;
        top: -10px;
        color: white;
        font-size: 1em;
        text-shadow: 0 0 1px #000;
        user-select: none;
        z-index: 0;
        pointer-events: none;
        animation: fall linear infinite;
      }

      @keyframes fall {
        0% {
          transform: translateY(-10vh) translateX(0);
        }
        100% {
          transform: translateY(100vh) translateX(20px);
        }
      }
    </style>
  </head>
  <body>
    <div class="calculator">
      <h1>Bitcoin Goal Calculator</h1>
      <div class="current-price">
        Current Bitcoin Price: <span id="btcPrice">Loading...</span>
      </div>
      <div class="info-box">
        This calculator accounts for Bitcoin's annual growth rate which affects
        both the price of Bitcoin and the value of your holdings. The growth
        rate you specify will compound yearly, increasing both the Bitcoin price
        and the value of your accumulated Bitcoin.
      </div>
      <div class="input-group">
        <label for="currentBtc">Current Bitcoin Holdings (BTC)</label>
        <input
          type="number"
          id="currentBtc"
          step="0.00000001"
          min="0"
          value="0"
          placeholder="0.0"
          onfocus="this.select()"
        />
      </div>
      <div class="input-group">
        <label for="monthlyInvestment">Monthly Investment (USD)</label>
        <input
          type="number"
          id="monthlyInvestment"
          min="0"
          value="100"
          placeholder="100"
          onfocus="this.select()"
        />
      </div>
      <div class="input-group">
        <label for="growthRate">Annual Growth Rate (%)</label>
        <input
          type="number"
          id="growthRate"
          min="0"
          value="25"
          placeholder="25"
          onfocus="this.select()"
        />
      </div>
      <div class="input-group">
        <label for="targetBtc">Target Bitcoin Amount (BTC)</label>
        <input
          type="number"
          id="targetBtc"
          step="0.00000001"
          min="0"
          value="1.0"
          placeholder="1.0"
          onfocus="this.select()"
        />
      </div>
      <button onclick="calculate()">Calculate</button>
      <div id="result"></div>
      <div id="error-message"></div>
    </div>
    <script>
      let currentBtcPrice = 0;

      // Snow animation
      function createSnowflake() {
        const snowflake = document.createElement("div");
        snowflake.classList.add("snowflake");
        snowflake.innerHTML = "❄";
        snowflake.style.left = Math.random() * 100 + "vw";
        snowflake.style.animationDuration = Math.random() * 3 + 2 + "s";
        snowflake.style.opacity = Math.random();
        snowflake.style.fontSize = Math.random() * 10 + 10 + "px";

        document.body.appendChild(snowflake);

        setTimeout(() => {
          snowflake.remove();
        }, 5000);
      }

      // Create snowflakes periodically
      setInterval(createSnowflake, 100);

      async function fetchBitcoinPrice() {
        try {
          const response = await fetch(
            "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd"
          );
          const data = await response.json();
          currentBtcPrice = data.bitcoin.usd;
          document.getElementById(
            "btcPrice"
          ).textContent = `$${currentBtcPrice.toLocaleString()}`;
        } catch (error) {
          document.getElementById("btcPrice").textContent =
            "Error fetching price";
          console.error("Error fetching Bitcoin price:", error);
        }
      }

      function getInputValue(id, defaultValue = 0) {
        const element = document.getElementById(id);
        const value = parseFloat(element.value.replace(/[^\d.-]/g, ""));
        return isNaN(value) ? defaultValue : value;
      }

      function formatCurrency(value) {
        return new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(value);
      }

      function showResult(message, isError = false) {
        const resultDiv = document.getElementById("result");
        const errorDiv = document.getElementById("error-message");

        if (isError) {
          errorDiv.textContent = message;
          errorDiv.className = "error";
          errorDiv.style.display = "block";
          resultDiv.style.display = "none";
        } else {
          errorDiv.style.display = "none";
          resultDiv.innerHTML = message;
          resultDiv.className = "success";
          resultDiv.style.display = "block";
        }
      }

      function createProjectionTable(projections) {
        const table = document.createElement("table");
        table.innerHTML = `
          <tr>
            <th>Year</th>
            <th>BTC Amount</th>
            <th>BTC Price</th>
            <th>Portfolio Value</th>
            <th>Total Invested</th>
            <th>ROI</th>
          </tr>
        `;

        projections.forEach((p) => {
          const row = document.createElement("tr");
          const roi = (p.value / p.invested - 1) * 100;
          row.innerHTML = `
            <td>${p.year}</td>
            <td>${p.btc.toFixed(8)}</td>
            <td>${formatCurrency(p.price)}</td>
            <td>${formatCurrency(p.value)}</td>
            <td>${formatCurrency(p.invested)}</td>
            <td>${roi.toFixed(1)}%</td>
          `;
          table.appendChild(row);
        });

        return table;
      }

      function calculate() {
        const currentBtc = getInputValue("currentBtc", 0);
        const monthlyInvestment = getInputValue("monthlyInvestment", 100);
        const annualGrowthRate = getInputValue("growthRate", 25);
        const targetBtc = getInputValue("targetBtc", 1);

        if (targetBtc < 0.00000001) {
          showResult(
            "Please enter a target Bitcoin amount greater than 0",
            true
          );
          return;
        }

        if (monthlyInvestment < 1) {
          showResult(
            "Please enter a monthly investment amount of at least $1",
            true
          );
          return;
        }

        if (annualGrowthRate < 0) {
          showResult("Please enter a non-negative growth rate", true);
          return;
        }

        if (currentBtcPrice <= 0) {
          showResult("Unable to calculate: Bitcoin price not available", true);
          return;
        }

        if (currentBtc >= targetBtc) {
          showResult("You already have more than your target amount!", true);
          return;
        }

        let btcAccumulated = currentBtc;
        let totalInvestment = 0;
        let months = 0;
        const maxMonths = 1200; // 100 years limit
        let projections = [];
        let currentProjectedPrice = currentBtcPrice;
        let currentDate = new Date();
        const monthlyRate = annualGrowthRate / 12 / 100;

        while (btcAccumulated < targetBtc && months < maxMonths) {
          const monthlyBtc = monthlyInvestment / currentProjectedPrice;
          btcAccumulated += monthlyBtc;
          totalInvestment += monthlyInvestment;
          currentProjectedPrice *= 1 + monthlyRate;

          if (btcAccumulated > monthlyBtc) {
            btcAccumulated *= 1 + monthlyRate;
          }

          currentDate.setMonth(currentDate.getMonth() + 1);
          months++;

          if (months % 12 === 0) {
            projections.push({
              year: (months / 12).toFixed(0),
              btc: btcAccumulated,
              price: currentProjectedPrice,
              value: btcAccumulated * currentProjectedPrice,
              invested: totalInvestment,
            });
          }
        }

        if (months >= maxMonths) {
          showResult(
            "It would take over 100 years to reach your goal with these parameters.\n\n" +
              "Consider:\n" +
              "- Increasing your monthly investment\n" +
              "- Adjusting your target amount\n" +
              "- Reviewing the growth rate assumptions",
            true
          );
        } else {
          const years = Math.floor(months / 12);
          const remainingMonths = months % 12;

          let resultHtml = `
            <h3>Summary</h3>
            <p>Estimated time to reach your goal: ${years} year${
            years !== 1 ? "s" : ""
          }
            ${
              remainingMonths > 0
                ? ` and ${remainingMonths} month${
                    remainingMonths !== 1 ? "s" : ""
                  }`
                : ""
            }</p>
            <p>Final BTC: ${btcAccumulated.toFixed(8)} BTC</p>
            <p>Projected BTC Price: ${formatCurrency(currentProjectedPrice)}</p>
            <p>Final Portfolio Value: ${formatCurrency(
              btcAccumulated * currentProjectedPrice
            )}</p>
            <p>Total Investment: ${formatCurrency(totalInvestment)}</p>
            <p>Return on Investment: ${(
              ((btcAccumulated * currentProjectedPrice) / totalInvestment - 1) *
              100
            ).toFixed(1)}%</p>
            <h3>Year-by-Year Projections</h3>
          `;

          showResult(resultHtml);
          document
            .getElementById("result")
            .appendChild(createProjectionTable(projections));
        }
      }

      document.querySelectorAll('input[type="number"]').forEach((input) => {
        input.addEventListener("input", function (e) {
          let value = this.value.replace(/[^\d.-]/g, "");
          if (value) {
            this.value = parseFloat(value);
          }
        });
      });

      fetchBitcoinPrice();
      setInterval(fetchBitcoinPrice, 60000);
    </script>
  </body>
</html>
