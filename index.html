<!DOCTYPE html>
<!-- Previous content remains the same until the mobile styles -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bitcoin Goal Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* Previous styles remain the same until the mobile styles */
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),
          url("https://images.unsplash.com/photo-1544635576-5f58e89be4f6?q=80&w=1000");
        background-size: cover;
        background-attachment: fixed;
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .calculator {
        background-color: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
        border: 2px solid #c41e3a;
      }
      .input-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #c41e3a;
      }
      input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      input:focus {
        outline: none;
        border-color: #f7931a;
      }
      button {
        background-color: #c41e3a;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        font-size: 16px;
      }
      button:hover {
        background-color: #a01830;
      }
      #result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 4px;
        background-color: rgba(240, 240, 240, 0.9);
        display: none;
      }
      .current-price {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.2em;
        color: #c41e3a;
      }
      .error {
        background-color: #ffe6e6;
        color: #d63939;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
      }
      .success {
        background-color: rgba(230, 255, 230, 0.9);
        color: #2d862d;
      }
      .info-box {
        background-color: rgba(230, 243, 255, 0.9);
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        font-size: 0.9em;
      }
      .table-container {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin: 0 auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        min-width: 400px; /* Further reduced from 450px */
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: right;
        white-space: nowrap;
      }
      th {
        background-color: #c41e3a;
        color: white;
        text-align: center;
      }
      tr:nth-child(even) {
        background-color: rgba(249, 249, 249, 0.9);
      }
      .halving-row {
        background-color: rgba(255, 243, 230, 0.9) !important;
        font-weight: bold;
      }
      h1 {
        color: #c41e3a;
        text-align: center;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }
      .chart-container {
        margin-top: 20px;
        background-color: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 8px;
      }

      /* Snow Animation */
      .snowflake {
        position: fixed;
        top: -10px;
        color: white;
        font-size: 1em;
        text-shadow: 0 0 1px #000;
        user-select: none;
        z-index: 0;
        pointer-events: none;
        animation: fall linear infinite;
      }

      @keyframes fall {
        0% {
          transform: translateY(-10vh) translateX(0);
        }
        100% {
          transform: translateY(100vh) translateX(20px);
        }
      }

      /* Mobile-specific styles */
      @media screen and (max-width: 600px) {
        body {
          padding: 10px;
        }
        .calculator {
          padding: 15px;
        }
        .table-container {
          width: 100%;
          margin: 0 auto;
          font-size: 0.75em;
          display: flex;
          justify-content: center;
        }
        table {
          min-width: 380px;
          max-width: 100%;
        }
        th,
        td {
          padding: 3px 4px;
        }
        #result {
          padding: 10px;
        }
        h3 {
          font-size: 1.1em;
        }
      }
    </style>
  </head>
  <!-- Rest of the HTML content remains exactly the same -->
  <body>
    <div class="calculator">
      <h1>Bitcoin Goal Calculator</h1>
      <div class="current-price">
        Current Bitcoin Price: <span id="btcPrice">Loading...</span>
      </div>
      <div class="info-box">
        This calculator accounts for Bitcoin's annual growth rate which affects
        both the price of Bitcoin and the value of your holdings. The growth
        rate you specify will compound yearly, increasing both the Bitcoin price
        and the value of your accumulated Bitcoin.
      </div>
      <div class="input-group">
        <label for="currentBtc">Current Bitcoin Holdings (BTC)</label>
        <input
          type="text"
          id="currentBtc"
          step="0.00000001"
          value="0"
          placeholder="0.0"
          onfocus="this.select()"
        />
      </div>
      <div class="input-group">
        <label for="monthlyInvestment">Monthly Investment (USD)</label>
        <input
          type="text"
          id="monthlyInvestment"
          value="100"
          placeholder="100"
          onfocus="this.select()"
        />
      </div>
      <div class="input-group">
        <label for="growthRate">Annual Growth Rate (%)</label>
        <input
          type="text"
          id="growthRate"
          value="25"
          placeholder="25"
          onfocus="this.select()"
        />
      </div>
      <div class="input-group">
        <label for="targetBtc">Target Bitcoin Amount (BTC)</label>
        <input
          type="text"
          id="targetBtc"
          step="0.00000001"
          value="1.0"
          placeholder="1.0"
          onfocus="this.select()"
        />
      </div>
      <button onclick="calculate()">Calculate</button>
      <div id="result"></div>
      <div id="error-message"></div>
      <div class="chart-container">
        <canvas id="projectionChart"></canvas>
      </div>
    </div>
    <script>
      let currentBtcPrice = 0;
      let projectionChart = null;

      // Previous JavaScript functions remain the same until formatCurrency
      function createSnowflake() {
        const snowflake = document.createElement("div");
        snowflake.classList.add("snowflake");
        snowflake.innerHTML = "❄";
        snowflake.style.left = Math.random() * 100 + "vw";
        snowflake.style.animationDuration = Math.random() * 3 + 2 + "s";
        snowflake.style.opacity = Math.random();
        snowflake.style.fontSize = Math.random() * 10 + 10 + "px";

        document.body.appendChild(snowflake);

        setTimeout(() => {
          snowflake.remove();
        }, 5000);
      }

      setInterval(createSnowflake, 100);

      async function fetchBitcoinPrice() {
        try {
          const response = await fetch(
            "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd"
          );
          const data = await response.json();
          currentBtcPrice = data.bitcoin.usd;
          document.getElementById(
            "btcPrice"
          ).textContent = `$${currentBtcPrice.toLocaleString()}`;
        } catch (error) {
          document.getElementById("btcPrice").textContent =
            "Error fetching price";
          console.error("Error fetching Bitcoin price:", error);
        }
      }

      function getInputValue(id, defaultValue = 0) {
        const element = document.getElementById(id);
        const value = parseFloat(element.value);
        return isNaN(value) ? defaultValue : value;
      }

      function formatCurrency(value) {
        // Even more compact number formatting
        const decimalPlaces = value >= 1000000 ? 0 : value >= 10000 ? 1 : 2;
        const formatted = new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: decimalPlaces,
          maximumFractionDigits: decimalPlaces,
        }).format(value);

        // For very large numbers, use K/M/B notation
        if (value >= 1000000000) {
          return `${(value / 1000000000).toFixed(1)}B`;
        } else if (value >= 1000000) {
          return `${(value / 1000000).toFixed(1)}M`;
        } else if (value >= 1000) {
          return `${(value / 1000).toFixed(1)}K`;
        }
        return formatted;
      }

      // Previous JavaScript functions remain the same until createProjectionTable
      function showResult(message, isError = false) {
        const resultDiv = document.getElementById("result");
        const errorDiv = document.getElementById("error-message");

        if (isError) {
          errorDiv.textContent = message;
          errorDiv.className = "error";
          errorDiv.style.display = "block";
          resultDiv.style.display = "none";
        } else {
          errorDiv.style.display = "none";
          resultDiv.innerHTML = message;
          resultDiv.className = "success";
          resultDiv.style.display = "block";
        }
      }

      function updateChart(projections) {
        const labels = projections.map((p) => {
          const years = Math.floor(p.months / 12);
          const months = p.months % 12;
          return months > 0 ? `Year ${years}.${months}` : `Year ${years}`;
        });
        const portfolioValues = projections.map((p) => p.value);
        const btcPrices = projections.map((p) => p.price);
        const totalInvested = projections.map((p) => p.invested);

        if (projectionChart) {
          projectionChart.destroy();
        }

        const ctx = document.getElementById("projectionChart").getContext("2d");
        projectionChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Portfolio Value",
                data: portfolioValues,
                borderColor: "#c41e3a",
                backgroundColor: "rgba(196, 30, 58, 0.1)",
                fill: true,
                yAxisID: "y",
              },
              {
                label: "Bitcoin Price",
                data: btcPrices,
                borderColor: "#f7931a",
                backgroundColor: "rgba(247, 147, 26, 0.1)",
                fill: true,
                yAxisID: "y",
              },
              {
                label: "Total Invested",
                data: totalInvested,
                borderColor: "#2d862d",
                backgroundColor: "rgba(45, 134, 45, 0.1)",
                fill: true,
                yAxisID: "y",
              },
            ],
          },
          options: {
            responsive: true,
            interaction: {
              mode: "index",
              intersect: false,
            },
            scales: {
              y: {
                type: "logarithmic",
                display: true,
                position: "left",
                title: {
                  display: true,
                  text: "Value (USD)",
                },
              },
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.dataset.label}: ${formatCurrency(
                      context.raw
                    )}`;
                  },
                },
              },
            },
          },
        });
      }

      function createProjectionTable(projections) {
        const tableContainer = document.createElement("div");
        tableContainer.className = "table-container";

        const table = document.createElement("table");
        table.innerHTML = `
          <tr>
            <th>Time</th>
            <th>BTC</th>
            <th>Price</th>
            <th>Value</th>
            <th>Inv.</th>
            <th>ROI</th>
          </tr>
        `;

        projections.forEach((p) => {
          const years = Math.floor(p.months / 12);
          const months = p.months % 12;
          const timeLabel = months > 0 ? `Y${years}.${months}` : `Y${years}`;

          const row = document.createElement("tr");
          const roi = (p.value / p.invested - 1) * 100;
          row.innerHTML = `
            <td>${timeLabel}</td>
            <td>${Number(p.btc.toFixed(3))}</td>
            <td>${formatCurrency(p.price)}</td>
            <td>${formatCurrency(p.value)}</td>
            <td>${formatCurrency(p.invested)}</td>
            <td>${roi.toFixed(0)}%</td>
          `;
          table.appendChild(row);
        });

        tableContainer.appendChild(table);
        return tableContainer;
      }

      // Rest of the JavaScript remains the same
      function calculate() {
        const currentBtc = getInputValue("currentBtc", 0);
        const monthlyInvestment = getInputValue("monthlyInvestment", 100);
        const annualGrowthRate = getInputValue("growthRate", 25);
        const targetBtc = getInputValue("targetBtc", 1);

        if (targetBtc < 0.00000001) {
          showResult(
            "Please enter a target Bitcoin amount greater than 0",
            true
          );
          return;
        }

        if (monthlyInvestment < 1) {
          showResult(
            "Please enter a monthly investment amount of at least $1",
            true
          );
          return;
        }

        if (annualGrowthRate < 0) {
          showResult("Please enter a non-negative growth rate", true);
          return;
        }

        if (currentBtcPrice <= 0) {
          showResult("Unable to calculate: Bitcoin price not available", true);
          return;
        }

        if (currentBtc >= targetBtc) {
          showResult("You already have more than your target amount!", true);
          return;
        }

        let btcAccumulated = currentBtc;
        let totalInvestment = currentBtc * currentBtcPrice;
        let months = 0;
        const maxMonths = 1200; // 100 years limit
        let projections = [];
        let currentProjectedPrice = currentBtcPrice;
        let currentDate = new Date();
        const monthlyRate = annualGrowthRate / 12 / 100;

        // Add initial state
        projections.push({
          months: 0,
          btc: btcAccumulated,
          price: currentProjectedPrice,
          value: btcAccumulated * currentProjectedPrice,
          invested: totalInvestment,
        });

        while (btcAccumulated < targetBtc && months < maxMonths) {
          months++;

          // Update price first
          currentProjectedPrice *= 1 + monthlyRate;

          // Add monthly investment
          const monthlyBtc = monthlyInvestment / currentProjectedPrice;
          btcAccumulated += monthlyBtc;
          totalInvestment += monthlyInvestment;

          // Calculate current value
          const currentValue = btcAccumulated * currentProjectedPrice;

          // Add data point every 3 months or at the final point
          if (months % 3 === 0 || btcAccumulated >= targetBtc) {
            projections.push({
              months: months,
              btc: btcAccumulated,
              price: currentProjectedPrice,
              value: currentValue,
              invested: totalInvestment,
            });
          }
        }

        if (months >= maxMonths) {
          showResult(
            "It would take over 100 years to reach your goal with these parameters.\n\n" +
              "Consider:\n" +
              "- Increasing your monthly investment\n" +
              "- Adjusting your target amount\n" +
              "- Reviewing the growth rate assumptions",
            true
          );
        } else {
          const years = Math.floor(months / 12);
          const remainingMonths = months % 12;

          let resultHtml = `
            <h3>Summary</h3>
            <p>Estimated time to reach your goal: ${years} year${
            years !== 1 ? "s" : ""
          }
            ${
              remainingMonths > 0
                ? ` and ${remainingMonths} month${
                    remainingMonths !== 1 ? "s" : ""
                  }`
                : ""
            }</p>
            <p>Final BTC: ${btcAccumulated.toFixed(8)} BTC</p>
            <p>Projected BTC Price: ${formatCurrency(currentProjectedPrice)}</p>
            <p>Final Portfolio Value: ${formatCurrency(
              btcAccumulated * currentProjectedPrice
            )}</p>
            <p>Total Investment: ${formatCurrency(totalInvestment)}</p>
            <p>Return on Investment: ${(
              ((btcAccumulated * currentProjectedPrice) / totalInvestment - 1) *
              100
            ).toFixed(1)}%</p>
            <h3>Detailed Projections</h3>
          `;

          showResult(resultHtml);
          document
            .getElementById("result")
            .appendChild(createProjectionTable(projections));

          updateChart(projections);
        }
      }

      // Handle decimal input properly
      document.querySelectorAll('input[type="text"]').forEach((input) => {
        input.addEventListener("input", function (e) {
          let value = this.value;

          // Allow only numbers, one decimal point, and one minus sign at start
          value = value.replace(/[^\d.-]/g, "");

          // Ensure only one decimal point
          const decimalCount = (value.match(/\./g) || []).length;
          if (decimalCount > 1) {
            value = value.replace(/\.(?=.*\.)/g, "");
          }

          // Ensure minus sign is only at start
          if (value.lastIndexOf("-") > 0) {
            value = value.replace(/-/g, "");
            if (value.startsWith("-")) {
              value = "-" + value.substring(1);
            }
          }

          this.value = value;
        });
      });

      fetchBitcoinPrice();
      setInterval(fetchBitcoinPrice, 60000);
    </script>
  </body>
</html>
